{"ast":null,"code":"import _regeneratorRuntime from\"/home/pop_os_flex/Documents/Code/JavaScript/ReactJS/fakeblock-shopping/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/pop_os_flex/Documents/Code/JavaScript/ReactJS/fakeblock-shopping/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/pop_os_flex/Documents/Code/JavaScript/ReactJS/fakeblock-shopping/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{Component,useState,useEffect}from'react';import'./css/Payment.css';import{useStateValue}from'./StateProvider';import CheckoutProduct from'./CheckoutProduct';import{Link,useHistory}from'react-router-dom';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import CurrencyFormat from'react-currency-format';import{getBasketTotal}from'./reducer';import axios from'./axios';import{db}from'../firebase.js';function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),succeeded=_useState4[0],setSucceeded=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log('the secret is >>: ',clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;db.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:'EMPTY_BASKET'});history.replace('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){setDisabled(event.empty);setError(event.error?event.error.message:'');};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout(\",/*#__PURE__*/_jsxs(Link,{style:{textDecoration:'none',color:'black'},to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_address\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"}),/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"123 ReactJS Lane\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Atlanta, Georgia\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"payment_title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"}),/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total: \",value]})});},decimalScale:2,value:getBasketTotal(basket),displayType:'text',thousandSeperator:true,prefix:'$'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_priceContainer\",children:/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):'Buy Now'})})}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["/home/pop_os_flex/Documents/Code/JavaScript/ReactJS/fakeblock-shopping/src/Components/Payment.js"],"names":["React","Component","useState","useEffect","useStateValue","CheckoutProduct","Link","useHistory","CardElement","useStripe","useElements","CurrencyFormat","getBasketTotal","axios","db","Payment","basket","user","dispatch","history","stripe","elements","error","setError","succeeded","setSucceeded","processing","setProcessing","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","id","set","amount","created","type","replace","payload","handleChange","empty","message","textDecoration","color","length","email","map","item","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect } from 'react';\nimport './css/Payment.css';\nimport { useStateValue } from './StateProvider';\nimport CheckoutProduct from './CheckoutProduct';\nimport { Link, useHistory } from 'react-router-dom';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport CurrencyFormat from 'react-currency-format';\nimport { getBasketTotal } from './reducer';\nimport axios from './axios';\nimport { db } from '../firebase.js';\n\nfunction Payment() {\n\tconst [{ basket, user }, dispatch] = useStateValue();\n\tconst history = useHistory();\n\tconst stripe = useStripe();\n\tconst elements = useElements();\n\tconst [error, setError] = useState(null);\n\tconst [succeeded, setSucceeded] = useState(false);\n\tconst [processing, setProcessing] = useState('');\n\tconst [disabled, setDisabled] = useState(true);\n\tlet [clientSecret, setClientSecret] = useState('');\n\n\n\tuseEffect(() => {\n\t\tconst getClientSecret = async () => {\n\t\t\tconst response = await axios({\n\t\t\t\tmethod: 'post',\n\t\t\t\turl: `/payments/create?total=${getBasketTotal(basket) * 100}`\n\t\t\t});\n\t\t\tsetClientSecret(response.data.clientSecret);\n\t\t}\n\t\tgetClientSecret();\n\t}, [basket])\n\n\tconsole.log('the secret is >>: ', clientSecret);\n\n\tconst handleSubmit = async (event) => {\n\t\tevent.preventDefault();\n\t\tsetProcessing(true);\n\t\t\n\t\tlet payload = await stripe.confirmCardPayment(clientSecret, {\n\t\t\t\tpayment_method: {\n\t\t\t\t\tcard: elements.getElement(CardElement)\n\t\t\t\t}\n\t\t\t}).then(({ paymentIntent }) => {\n\t\t\t\t\tdb\n\t\t\t\t\t.collection('users')\n\t\t\t\t\t.doc(user?.uid)\n\t\t\t\t\t.collection('orders')\n\t\t\t\t\t.doc(paymentIntent.id)\n\t\t\t\t\t.set({\n\t\t\t\t\t\tbasket: basket,\n\t\t\t\t\t\tamount: paymentIntent.amount,\n\t\t\t\t\t\tcreated: paymentIntent.created\n\t\t\t\t\t})\n\n\n\t\t\t\tsetSucceeded(true);\n\t\t\t\tsetError(null);\n\t\t\t\tsetProcessing(false);\n\t\t\t\tdispatch({\n\t\t\t\t\ttype: 'EMPTY_BASKET'\n\t\t\t\t})\n\t\t\t\thistory.replace('/orders');\n\t\t\t});\n\t\t\t\n\t};\n\n\tconst handleChange = (event) => {\n\t\tsetDisabled(event.empty);\n\t\tsetError(event.error ? event.error.message : '');\n\t};\n\n\treturn (\n\t\t<div className=\"payment\">\n\t\t\t<div className=\"payment_container\">\n\t\t\t\t<h1>\n\t\t\t\t\tCheckout(\n\t\t\t\t\t<Link\n\t\t\t\t\t\tstyle={{ textDecoration: 'none', color: 'black' }}\n\t\t\t\t\t\tto=\"/checkout\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{basket?.length} items\n\t\t\t\t\t</Link>\n\t\t\t\t\t)\n\t\t\t\t</h1>\n\n\t\t\t\t<div className=\"payment_section\">\n\t\t\t\t\t<div className=\"payment_address\">\n\t\t\t\t\t\t<h3>Delivery Address</h3>\n\t\t\t\t\t\t<p>{user?.email}</p>\n\t\t\t\t\t\t<p>123 ReactJS Lane</p>\n\t\t\t\t\t\t<p>Atlanta, Georgia</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"payment_section\">\n\t\t\t\t\t<div className=\"payment_title\">\n\t\t\t\t\t\t<h3>Review items and delivery</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"payment_items\">\n\t\t\t\t\t\t{basket.map((item) => (\n\t\t\t\t\t\t\t<CheckoutProduct\n\t\t\t\t\t\t\t\tid={item.id}\n\t\t\t\t\t\t\t\ttitle={item.title}\n\t\t\t\t\t\t\t\timage={item.image}\n\t\t\t\t\t\t\t\tprice={item.price}\n\t\t\t\t\t\t\t\trating={item.rating}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"payment_section\">\n\t\t\t\t\t<div className=\"payment_title\">\n\t\t\t\t\t\t<h3>Payment Method</h3>\n\t\t\t\t\t\t<CurrencyFormat\n\t\t\t\t\t\t\t\t\trenderText={(value) => (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<h3>Order Total: {value}</h3>\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tdecimalScale={2}\n\t\t\t\t\t\t\t\t\tvalue={getBasketTotal(basket)}\n\t\t\t\t\t\t\t\t\tdisplayType={'text'}\n\t\t\t\t\t\t\t\t\tthousandSeperator={true}\n\t\t\t\t\t\t\t\t\tprefix={'$'}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"payment_details\">\n\t\t\t\t\t\t<form onSubmit={handleSubmit}>\n\t\t\t\t\t\t\t<CardElement onChange={handleChange} />\n\t\t\t\t\t\t\t<div className=\"payment_priceContainer\">\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<button disabled={processing || disabled || succeeded}>\n\t\t\t\t\t\t\t\t\t<span>{processing ? <p>Processing</p> : 'Buy Now'}</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{error && <div>{error}</div>}\n\t\t\t\t\t\t</form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default Payment;\n"]},"metadata":{},"sourceType":"module"}